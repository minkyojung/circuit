/**
 * Circuit Design System - Main Stylesheet
 * Import order matters: tokens → Tailwind → components
 */

/* Design tokens (colors, spacing, typography) */
@import './design-tokens.css';

/* Tailwind layers */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== BASE STYLES ===== */
@layer base {
  /* Default typography - Sans-serif for UI */
  * {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-weight: var(--font-medium);
  }

  /* Monospace font utility class for code elements */
  .font-mono {
    font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', 'Source Code Pro', 'SF Mono', Menlo, Consolas, Monaco, 'Courier New', monospace !important;
  }

  /* Force monospace font on all code elements */
  code,
  pre,
  kbd,
  samp,
  .shiki code,
  .shiki pre,
  .prose code,
  .prose pre,
  .prose pre code {
    font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', 'Source Code Pro', 'SF Mono', Menlo, Consolas, Monaco, 'Courier New', monospace !important;
  }

  /* Ensure inline code in prose also uses monospace */
  .prose :where(code):not(:where([class~="not-prose"] *))::before,
  .prose :where(code):not(:where([class~="not-prose"] *))::after {
    content: "" !important;
  }

  /* Body defaults */
  body {
    @apply text-foreground;
    color: var(--foreground);
    font-size: var(--font-base);
    line-height: var(--leading-normal);
    background-color: transparent;
  }

  /* Border color utility */
  * {
    @apply border-border;
  }
}

/* ===== COMPONENT LAYER ===== */
@layer components {
  /* Sidebar layout fixes */
  .group\/sidebar-wrapper:has([data-state="collapsed"][data-variant="inset"]) {
    @apply bg-sidebar;
  }

  /* Toast Glassmorphism Styling */
  [data-sonner-toast] {
    backdrop-filter: blur(12px) !important;
    -webkit-backdrop-filter: blur(12px) !important;
    background: var(--material-regular) !important;
    border: 1px solid var(--separator-opaque) !important;
    box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.1),
                0 4px 8px 0 rgba(0, 0, 0, 0.08) !important;
    color: var(--label-primary) !important;
  }

  /* Toast success variant */
  [data-sonner-toast][data-type="success"] {
    background: rgba(34, 197, 94, 0.15) !important;
    backdrop-filter: blur(12px) !important;
    border: 1px solid rgba(34, 197, 94, 0.3) !important;
  }

  /* Toast error variant */
  [data-sonner-toast][data-type="error"] {
    background: rgba(239, 68, 68, 0.15) !important;
    backdrop-filter: blur(12px) !important;
    border: 1px solid rgba(239, 68, 68, 0.3) !important;
  }

  /* Toast icon */
  [data-sonner-toast] [data-icon] {
    color: var(--label-primary) !important;
  }

  /* Toast title */
  [data-sonner-toast] [data-title] {
    color: var(--label-primary) !important;
    font-weight: var(--font-medium);
  }

  /* Toast description */
  [data-sonner-toast] [data-description] {
    color: var(--label-secondary) !important;
  }

  /* Toast close button */
  [data-sonner-toast] [data-close-button] {
    background: var(--fill-tertiary) !important;
    border: 1px solid var(--separator-translucent) !important;
    color: var(--label-secondary) !important;
  }

  [data-sonner-toast] [data-close-button]:hover {
    background: var(--fill-secondary) !important;
    color: var(--label-primary) !important;
  }

  [data-state="collapsed"][data-variant="inset"] ~ main {
    margin-left: 0;
  }

  /* Hide scrollbars */
  * {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  *::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  /* Electron app region (macOS traffic lights) */
  [data-webkit-app-region="drag"] {
    -webkit-app-region: drag;
    user-select: none;
  }

  [data-webkit-app-region="no-drag"] {
    -webkit-app-region: no-drag;
  }

  /* Typography utilities */
  .text-xs { font-size: var(--font-xs); }
  .text-sm { font-size: var(--font-sm); }
  .text-base { font-size: var(--font-base); }
  .text-md { font-size: var(--font-md); }
  .text-lg { font-size: var(--font-lg); }
  .text-xl { font-size: var(--font-xl); }
  .text-2xl { font-size: var(--font-2xl); }
  .text-3xl { font-size: var(--font-3xl); }

  /* ===== FOCUS RING STYLES (Apple HIG) ===== */

  /* Base focus ring style */
  *:focus-visible {
    outline: 2px solid var(--ring);
    outline-offset: 2px;
    transition: outline-color var(--transition-fast), outline-offset var(--transition-fast);
  }

  /* Button focus styles */
  button:focus-visible,
  [role="button"]:focus-visible {
    outline: 2px solid var(--ring);
    outline-offset: 2px;
  }

  /* Input/textarea focus styles */
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible {
    outline: 2px solid var(--ring);
    outline-offset: 0px;
    border-color: transparent;
  }

  /* Link focus styles */
  a:focus-visible {
    outline: 2px solid var(--ring);
    outline-offset: 2px;
    border-radius: var(--radius-sm);
  }

  /* Interactive list item focus */
  [role="option"]:focus-visible,
  [role="menuitem"]:focus-visible {
    outline: 2px solid var(--ring);
    outline-offset: -2px;
  }

  /* Remove default focus ring on click (only show for keyboard) */
  *:focus:not(:focus-visible) {
    outline: none;
  }

  /* ===== KEYBOARD NAVIGATION INDICATORS ===== */

  /* Show focus indicator when navigating with keyboard */
  .keyboard-nav *:focus {
    outline: 2px solid var(--ring);
    outline-offset: 2px;
  }

  /* Enhanced focus for command palette items */
  [data-command-item]:focus-visible {
    background-color: var(--sidebar-accent);
    outline: none;
  }

  /* Workspace item focus */
  [data-workspace-item]:focus-visible {
    outline: 2px solid var(--ring);
    outline-offset: -2px;
    border-radius: var(--radius-md);
  }

  /* ===== TERMINAL STYLES ===== */
  /* CSS variables for terminal styling */
  :root {
    --xterm-background: transparent;
    --xterm-font-weight: 300;
    --xterm-font-weight-bold: 600;
    --xterm-padding: 0;
  }

  /* Base xterm styles (essential from xterm.css) */
  .xterm {
    cursor: text;
    position: relative;
    user-select: none;
    -ms-user-select: none;
    -webkit-user-select: none;
    padding: var(--xterm-padding);
    font-weight: var(--xterm-font-weight) !important;
    background: var(--xterm-background) !important;
  }

  .xterm.focus,
  .xterm:focus {
    outline: none;
  }

  /* Override xterm internal layers - ALL must be transparent */
  .xterm .xterm-viewport,
  .xterm .xterm-screen,
  .xterm .xterm-rows,
  .xterm canvas,
  .xterm .xterm-helpers,
  .xterm .xterm-decoration-container {
    background-color: var(--xterm-background) !important;
    background: var(--xterm-background) !important;
  }

  /* Force WebGL canvas transparency */
  canvas.xterm-link-layer,
  canvas.xterm-cursor-layer,
  canvas.xterm-decoration-layer {
    background: var(--xterm-background) !important;
  }

  /* Custom scrollbar for terminal */
  .xterm .xterm-viewport::-webkit-scrollbar {
    width: 8px;
  }

  .xterm .xterm-viewport::-webkit-scrollbar-track {
    background: transparent;
  }

  .xterm .xterm-viewport::-webkit-scrollbar-thumb {
    background: hsl(var(--sidebar-foreground-muted) / 0.3);
    border-radius: 4px;
  }

  .xterm .xterm-viewport::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--sidebar-foreground-muted) / 0.5);
  }

  /* ===== RESIZABLE PANELS ===== */
  /* Completely disable all hover/active effects on resize handle */
  [data-panel-resize-handle-enabled],
  [data-panel-resize-handle-enabled]:hover,
  [data-panel-resize-handle-enabled]:active,
  [data-panel-resize-handle-enabled]:focus,
  [data-panel-resize-handle-enabled]:focus-visible,
  [data-panel-resize-handle-enabled][data-resize-handle-active],
  [data-panel-resize-handle-enabled][data-resize-handle-state="hover"],
  [data-panel-resize-handle-enabled][data-resize-handle-state="drag"] {
    cursor: col-resize !important;
    background: transparent !important;
    background-color: transparent !important;
    border: none !important;
    border-width: 0 !important;
    border-color: transparent !important;
    border-left: none !important;
    border-right: none !important;
    border-top: none !important;
    border-bottom: none !important;
    outline: none !important;
    outline-width: 0 !important;
    outline-color: transparent !important;
    box-shadow: none !important;
    opacity: 1 !important;
  }

  /* Remove all pseudo-elements */
  [data-panel-resize-handle-enabled]::before,
  [data-panel-resize-handle-enabled]::after,
  [data-panel-resize-handle-enabled]:hover::before,
  [data-panel-resize-handle-enabled]:hover::after,
  [data-panel-resize-handle-enabled]:active::before,
  [data-panel-resize-handle-enabled]:active::after,
  [data-panel-resize-handle-enabled]:focus::before,
  [data-panel-resize-handle-enabled]:focus::after,
  [data-panel-resize-handle-enabled][data-resize-handle-active]::before,
  [data-panel-resize-handle-enabled][data-resize-handle-active]::after,
  [data-panel-resize-handle-enabled][data-resize-handle-state="hover"]::before,
  [data-panel-resize-handle-enabled][data-resize-handle-state="hover"]::after,
  [data-panel-resize-handle-enabled][data-resize-handle-state="drag"]::before,
  [data-panel-resize-handle-enabled][data-resize-handle-state="drag"]::after {
    display: none !important;
    content: none !important;
    visibility: hidden !important;
    background: transparent !important;
    background-color: transparent !important;
    border: none !important;
    border-width: 0 !important;
    border-color: transparent !important;
    outline: none !important;
    outline-width: 0 !important;
    box-shadow: none !important;
    width: 0 !important;
    height: 0 !important;
    opacity: 0 !important;
  }

  /* Also target any child elements */
  [data-panel-resize-handle-enabled] *,
  [data-panel-resize-handle-enabled]:hover *,
  [data-panel-resize-handle-enabled]:active *,
  [data-panel-resize-handle-enabled]:focus *,
  [data-panel-resize-handle-enabled][data-resize-handle-active] * {
    background: transparent !important;
    background-color: transparent !important;
    border: none !important;
    border-width: 0 !important;
    border-color: transparent !important;
    outline: none !important;
  }
}
